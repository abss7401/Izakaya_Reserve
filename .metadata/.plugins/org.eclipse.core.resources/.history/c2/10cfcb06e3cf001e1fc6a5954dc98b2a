package com.example.practice.service;


import java.util.ArrayList;
import java.util.List;
import java.util.Optional;

import org.springframework.stereotype.Service;

import com.example.practice.entity.PostEntity;
import com.example.practice.entity.UserEntity;
import com.example.practice.model.Post;
import com.example.practice.model.User;
import com.example.practice.repository.PostRepository;
import com.example.practice.repository.UserRepository;

import jakarta.transaction.Transactional;
import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
@Slf4j
@Service
@RequiredArgsConstructor
public class PostService {
	
	private final UserRepository userRepository;
	private final PostRepository postRepository;
	
	public void create(User user, Post post) {
		Optional<UserEntity> byUsername = userRepository.findByUsername(user.getUsername());
		
		if (byUsername != null) {
			UserEntity userEntity = byUsername.get();
			
			userEntity = UserEntity.builder()
					.id(user.getId())
		            .username(user.getUsername())
		            .password(user.getPassword())
		            .name(user.getName())
		            .email(user.getEmail())
		            .birth(user.getBirth())
		            .build();
			
		    userRepository.save(userEntity);
		    
		    PostEntity postEntity = PostEntity.builder()
					.id(post.getId())
					.title(post.getTitle())
					.content(post.getContent())
					.createTime(post.getCreateTime())
					.user(userEntity)
					.build();
			
			postRepository.save(postEntity);
		}
	}

	public List<Post> findAll() {
		List<PostEntity> postEntityList = postRepository.findAll();
		List<Post> postList = new ArrayList<>();
		for(PostEntity postEntity : postEntityList) {
			postList.add(postEntity.toPost());
		}
		return postList;
	}

}
